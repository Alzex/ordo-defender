generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model chat {
  id              Int          @id @default(autoincrement())
  tgId            BigInt       @unique
  greetingMessage String?      @db.VarChar(255)
  punishments     punishment[]
  maxWarns        Int
  createdAt       DateTime     @default(now())
}

model punishment {
  id            Int            @id @default(autoincrement())
  reason        String?        @db.VarChar(255)
  issuer        user           @relation(fields: [issuerId], references: [id], name: "issuer", onDelete: NoAction, onUpdate: NoAction)
  issuerId      Int
  violator      user           @relation(fields: [violatorId], references: [id], name: "violator", onDelete: NoAction, onUpdate: NoAction)
  violatorId    Int
  chat          chat           @relation(fields: [chatId], references: [id])
  chatId        Int
  type          punishmentType
  createdAt     DateTime       @default(now())
  isDisposed    Boolean        @default(false)
  disposeReason String?        @db.VarChar(255)
  disposer      user?          @relation(fields: [disposerId], references: [id], name: "disposer", onDelete: NoAction, onUpdate: NoAction)
  disposerId    Int?
  disposedAt    DateTime?
}

model user {
  id                  Int          @id @default(autoincrement())
  tgId                BigInt       @unique
  issuedPunishments   punishment[] @relation(name: "issuer")
  recievedPunishments punishment[] @relation(name: "violator")
  disposedPunishments punishment[] @relation(name: "disposer")
  languageCode        String       @default("en") @db.VarChar(10)
  createdAt           DateTime     @default(now())
}

enum punishmentType {
  BAN
  KICK
  WARN
}
